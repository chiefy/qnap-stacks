version: "3.8"

services:
  snapserver:
    container_name: snapserver
    depends_on:
      - mopidy
    image: chiefy/librespot-snapserver:0.27.0
    volumes:
      - "/mnt/Config/Snapcast/snapserver.conf:/etc/snapserver.conf"
      - "snapfifo:/var/local/snap:ro"
    environment:
      DEVICE_NAME: Cygnus
    network_mode: "host"
    restart: always
  
  mopidy:
    image: ghcr.io/chiefy/snapcast-mopidy/mopidy:latest
    container_name: mopidy
    devices:
      - "/dev/snd"
    ports:
      - "6600:6600"
      - "6680:6680"
    restart: always
    volumes:
      - "/mnt/Config/Mopidy/mopidy.conf:/config/mopidy.conf"
      - "/mnt/Mopidy/local:/usr/share/mopidy/local"
      - "/mnt/Mopidy/m3u:/usr/share/mopidy/m3u"
      - "/mnt/Music:/share/Music"
      - "snapfifo:/var/local/snap"

  podgrab:
    image: wiseindy/podgrab
    container_name: podgrab
    environment:
      - CHECK_FREQUENCY=240
    volumes:
      - /mnt/Config/Podgrab:/config
      - /mnt/Pods:/assets
    ports:
      - 8181:8080
    restart: always

  navidrome:
    image: deluan/navidrome:latest
    container_name: navidrome
    user: "1000:100"
    ports:
      - "4533:4533"
    restart: always
    environment:
      ND_SCANSCHEDULE: 1h
      ND_LOGLEVEL: info  
      ND_SESSIONTIMEOUT: 24h
      ND_BASEURL: "/"
      ND_TRANSCODINGCACHESIZE: "5GB"
      ND_IMAGECACHESIZE: "1GB"
      ND_ENABLEGRAVATAR: "true"
      ND_ENABLETRANSCODINGCONFIG: "false"
    volumes:
      - "/mnt/Config/Navidrome:/data"
      - "/mnt/Music:/music:ro"
      - "snapfifo:/var/local/snap"
volumes:
  snapfifo:
