version: "3.8"

services:
  snapserver:
    container_name: snapserver
    depends_on:
      - mpd
    image: ghcr.io/chiefy/dockerfiles/snapcast-librespot:latest
    volumes:
      - "/mnt/Config/snapserver/snapserver.conf:/etc/snapserver.conf"
      - "snapfifo:/tmp/snapfifo:ro"
    environment:
      DEVICE_NAME: docker
    network_mode: host
    restart: always

  mpd:
    image: ghcr.io/chiefy/dockerfiles/mpd:latest
    container_name: mpd
    ports:
      - "6600:6600"
    restart: always
    volumes:
      - /mnt/Config/mpd/mpd.conf:/etc/mpd.conf
      - /usr/share/mpd:/var/lib/mpd
      - /mnt/Config/mpd/playlists/:/var/lib/mpd/playlists
      - /mnt/Music:/mnt/Music:ro
      - snapfifo:/tmp/snapfifo

  mympd:
    image: ghcr.io/jcorporation/mympd/mympd
    container_name: mympd
    user: 1000:1000
    ports:
      - "9999:80"
    environment:
      - UMASK_SET=022
      - MYMPD_SSL=false
      - MPD_HOST=mpd
      - MPD_PORT=6600
    volumes:
      - /mnt/Config/mpd/mympd/:/var/lib/mympd/
      - /tmp/mympdcache:/var/cache/mympd/
      - /mnt/Music/:/music/:ro
      - /mnt/Config/mpd/playlists/:/playlists/
    restart: unless-stopped

  audiobookshelf:
    image: ghcr.io/advplyr/audiobookshelf:latest
    container_name: audiobookshelf
    ports:
      - 13378:80
    volumes:
      - /mnt/Audiobooks:/audiobooks
      - /mnt/Pods:/podcasts
      - /usr/share/audiobookshelf:/config
      - /mnt/Config/audiobookshelf/metadata:/metadata

  navidrome:
    image: deluan/navidrome:latest
    container_name: navidrome
    user: "0:100"
    ports:
      - "4533:4533"
    restart: always
    environment:
      ND_SCANSCHEDULE: 1h
      ND_LOGLEVEL: info
      ND_SESSIONTIMEOUT: 24h
      ND_BASEURL: "/"
      ND_TRANSCODINGCACHESIZE: "5GB"
      ND_IMAGECACHESIZE: "1GB"
      ND_ENABLEGRAVATAR: "true"
      ND_ENABLETRANSCODINGCONFIG: "false"
    volumes:
      - /mnt/Config/navidrome:/data
      - /mnt/Music:/music:ro

volumes:
  snapfifo:
