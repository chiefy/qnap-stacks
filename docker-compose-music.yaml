version: "3.8"

services:
  snapserver:
    container_name: snapserver
    depends_on:
      - mpd
    image: chiefy/librespot-snapserver:0.27.0
    volumes:
      - "/mnt/Config/snapserver/snapserver.conf:/etc/snapserver.conf"
      - "snapfifo:/tmp/snapfifo:ro"
    environment:
      DEVICE_NAME: docker
    network_mode: "host"
    restart: always

  mpd:
    image: ghcr.io/chiefy/dockerfiles/mpd:latest
    container_name: mpd
    ports:
      - "6600:6600"
    restart: always
    volumes:
      - "/mnt/Config/mpd/mpd.conf:/etc/mpd.conf"
      - "/mnt/Config/mpd:/var/lib/mpd"
      - "/mnt/Music:/mnt/Music"
      - "snapfifo:/tmp/snapfifo"

  audiobookshelf:
    image: ghcr.io/advplyr/audiobookshelf:latest
    ports:
      - 13378:80
    volumes:
      - /mnt/Audiobooks:/audiobooks
      - /mnt/Pods:/podcasts
      - /mnt/Config/audiobookshelf/config:/config
      - /mnt/Config/audiobookshelf/metadata:/metadata
  
  navidrome:
    image: deluan/navidrome:latest
    container_name: navidrome
    user: "0:100"
    ports:
      - "4533:4533"
    restart: always
    environment:
      ND_SCANSCHEDULE: 1h
      ND_LOGLEVEL: info  
      ND_SESSIONTIMEOUT: 24h
      ND_BASEURL: "/"
      ND_TRANSCODINGCACHESIZE: "5GB"
      ND_IMAGECACHESIZE: "1GB"
      ND_ENABLEGRAVATAR: "true"
      ND_ENABLETRANSCODINGCONFIG: "false"
    volumes:
      - "/mnt/Config/navidrome:/data"
      - "/mnt/Music:/music:ro"
      - "snapfifo:/var/local/snap"

volumes:
  snapfifo:
  
