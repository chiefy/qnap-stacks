version: "3.8"

services:
  snapserver:
    container_name: snapserver
    depends_on:
      - mopidy
    image: chiefy/librespot-snapserver:0.27.0
    volumes:
      - "/mnt/Config/snapserver/snapserver.conf:/etc/snapserver.conf"
      - "snapfifo:/var/local/snap:ro"
    environment:
      DEVICE_NAME: docker
    network_mode: "host"
    restart: always
  
  mopidy:
    image: ghcr.io/chiefy/snapcast-mopidy/mopidy:latest
    container_name: mopidy
   # devices:
   #   - "/dev/snd"
    ports:
      - "6600:6600"
      - "6680:6680"
    restart: always
    volumes:
      - "/mnt/Config/mopidy/conf/mopidy.conf:/config/mopidy.conf"
      - "/usr/share/mopidy/local:/usr/share/mopidy/local"
      - "/mnt/Config/mopidy/m3u:/usr/share/mopidy/m3u"
      - "/mnt/Music:/mnt/Music"
      - "snapfifo:/var/local/snap"

  audiobookshelf:
    image: ghcr.io/advplyr/audiobookshelf:latest
    ports:
      - 13378:80
    volumes:
      - /mnt/Audiobooks:/audiobooks
      - /mnt/Pods:/podcasts
      - /mnt/Config/audiobookshelf/config:/config
      - /mnt/Config/audiobookshelf/metadata:/metadata
  
  navidrome:
    image: deluan/navidrome:latest
    container_name: navidrome
    user: "0:100"
    ports:
      - "4533:4533"
    restart: always
    environment:
      ND_SCANSCHEDULE: 1h
      ND_LOGLEVEL: info  
      ND_SESSIONTIMEOUT: 24h
      ND_BASEURL: "/"
      ND_TRANSCODINGCACHESIZE: "5GB"
      ND_IMAGECACHESIZE: "1GB"
      ND_ENABLEGRAVATAR: "true"
      ND_ENABLETRANSCODINGCONFIG: "false"
    volumes:
      - "/mnt/Config/navidrome:/data"
      - "/mnt/Music:/music:ro"
      - "snapfifo:/var/local/snap"

volumes:
  snapfifo:
  podfetch-db:
